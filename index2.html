<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Three.js Interactive Nodes</title>
    <style>
        #myIframe {
            display: none;
            width: 100%;
            height: 500px;
            border: none;
        }
        #infoCard {
            display: none;
            position: fixed;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border: 1px solid #000;
            z-index: 100;
        }
    </style>
</head>
<body>

<div id="menu">
    <div id="home" class="menu-item">Home</div>
    <div id="publications" class="menu-item">Publications</div>
</div>
<div id="myquote">
    <blockquote>Life is full of surprises.</blockquote>
</div>

<div id="infoCard">
    <!-- Info Card content will be injected here -->
</div>
<iframe id="myIframe" src="">Your browser does not support iframes.</iframe>

<script type="module">
import * as THREE from 'https://mote-z.github.io/three.module.js'; // Adjust the path to your three.js library

// Initialize the scene, camera, and renderer
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Raycaster for mouse interaction
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();


// Handle mouse move event
function onMouseMove(event) {
    event.preventDefault();
    mouse.x = (event.clientX / renderer.domElement.clientWidth) * 2 - 1;
    mouse.y = -(event.clientY / renderer.domElement.clientHeight) * 2 + 1;
    raycaster.setFromCamera(mouse, this.camera);

    const intersects = raycaster.intersectObjects(scene.children);
    if (intersects.length > 0) {
        console.log(intersects)
        const intersectedObject = intersects[0].object;
        intersectedObject.material.color.set(this.color16())
        if (intersectedObject.userData) {
            document.getElementById('infoCard').style.display = 'block';
            document.getElementById('infoCard').innerHTML = `
                <h3>${intersectedObject.userData.categories.join(', ')}</h3>
                <p>Link: <a href="${intersectedObject.userData.link}" target="_blank">Open PDF</a></p>
            `;
        }
    } else {
        document.getElementById('infoCard').style.display = 'none';
    }
}

// Handle mouse click event
function onMouseDown(event) {
    event.preventDefault();
    // Repeat the raycaster setup from mouse move
    // and check intersects to load the PDF
}

// Add event listeners
document.addEventListener('mousemove', onMouseMove, false);


// Function to load articles data from JSON
function loadArticlesData(url) {
    fetch(url)
    .then(response => response.json())
    .then(data => {
        const articles = data.articles;
        articles.forEach(article => {
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshPhongMaterial();
            const cube = new THREE.Mesh(geometry, material);
            cube.position.x = Math.random() * 500 - 250;
            cube.position.y = Math.random() * 500 - 250;
            cube.userData = {link: article.link, categories: article.categories};
            scene.add(cube);
        });
    })
    .catch(error => console.error('Error loading JSON:', error));
}

// Animation loop
function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
}

// Start the animation loop
animate();

// Load articles data
loadArticlesData('https://mote-z.github.io/articles.json');

</script>
</body>
</html>